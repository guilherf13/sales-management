<p align="center"><a href="https://laravel.com" target="_blank"><img src="https://raw.githubusercontent.com/laravel/art/master/logo-lockup/5%20SVG/2%20CMYK/1%20Full%20Color/laravel-logolockup-cmyk-red.svg" width="400" alt="Logo do Laravel"></a></p>

# üìä Sistema de Gerenciamento de Vendas (Sales Management)

Sistema completo de gerenciamento de vendas e comiss√µes, constru√≠do com **Laravel 12** e **Vue.js 3**, com funcionalidades de:
- üìà Dashboard com estat√≠sticas e gr√°ficos comparativos
- üë• Gerenciamento de vendedores
- üí∞ Registro e acompanhamento de vendas
- üìß Envio autom√°tico de relat√≥rios por e-mail
- üîê Autentica√ß√£o e controle de acesso por perfil

---

## üìã √çndice

- [Pr√©-requisitos](#-pr√©-requisitos)
- [Instala√ß√£o e Execu√ß√£o](#-instala√ß√£o-e-execu√ß√£o)
- [Credenciais de Teste](#-credenciais-de-teste)
- [Executando Seeders](#-executando-seeders)
- [Documenta√ß√£o Adicional](#-documenta√ß√£o-adicional)
- [API - Endpoints e Exemplos](#-api---endpoints-e-exemplos)
- [Servi√ßos Dispon√≠veis](#-servi√ßos-dispon√≠veis)
- [Sistema de E-mails](#-sistema-de-e-mails)
- [Comandos √öteis](#-comandos-√∫teis)

---

## üîß Pr√©-requisitos

Para executar este projeto, voc√™ precisar√° ter instalado:
- [Docker](https://www.docker.com/get-started)
- [Docker Compose](https://docs.docker.com/compose/install/)

> **Nota:** O PHP, Composer e Node.js n√£o s√£o necess√°rios na sua m√°quina, pois o ambiente √© totalmente containerizado.

---

## üöÄ Instala√ß√£o e Execu√ß√£o

### Passo 1: Clonar o Reposit√≥rio

```bash
git clone https://github.com/guilherf13/sales-management.git
cd sales-management
```

### Passo 2: Configurar Vari√°veis de Ambiente

#### Criar arquivo .env do Laravel
```bash
cp .env.example .env
```

#### Verificar configura√ß√µes do banco de dados no .env
As configura√ß√µes padr√£o j√° est√£o corretas para o Docker:
```dotenv
DB_CONNECTION=mysql
DB_HOST=db
DB_PORT=3306
DB_DATABASE=laravel_db
DB_USERNAME=laravel_user
DB_PASSWORD=user_password

# Redis
CACHE_STORE=redis
QUEUE_CONNECTION=redis
REDIS_HOST=redis

# E-mail (Mailpit)
MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="noreply@example.com"
```

### Passo 3: Ajustar Permiss√µes (Opcional)

Para evitar problemas de permiss√£o entre seu sistema e o container, ajuste o UID/GID no `docker/php/Dockerfile`:

**Descobrir seu UID e GID:**
    ```bash
    echo "Seu UID √©: $(id -u)"
    echo "Seu GID √©: $(id -g)"
    ```

**Editar `docker/php/Dockerfile`:**
```dockerfile
ARG UID=1000  # Substitua pelo seu UID
ARG GID=1000  # Substitua pelo seu GID
```

### Passo 4: Construir e Iniciar os Containers

```bash
docker-compose up -d --build
```

### Passo 5: Instalar Depend√™ncias e Configurar Laravel

```bash
# Instalar depend√™ncias do Composer
docker-compose exec app composer install

# Gerar chave da aplica√ß√£o
docker-compose exec app php artisan key:generate

# Executar migrations e seeders
docker-compose exec app php artisan migrate:fresh --seed
```

### Passo 6: Iniciar o Worker de Filas (Para E-mails)

```bash
docker-compose exec -d app php artisan queue:listen --tries=3 --timeout=60
```

---

## ‚úÖ Aplica√ß√£o Pronta!

Acesse:
- **Frontend (Vue.js):** üëâ **[http://localhost:5173](http://localhost:5173)**
- **Backend (API):** üëâ **[http://localhost:8080/api](http://localhost:8080/api)**
- **Mailpit (E-mails):** üëâ **[http://localhost:8025](http://localhost:8025)**

---

## üîê Credenciais de Teste

Fa√ßa login em: **[http://localhost:5173/login](http://localhost:5173/login)**

| Perfil | E-mail | Senha | Permiss√µes |
|--------|--------|-------|------------|
| **Gestor (Admin)** | `admin@test.com` | `password` | Acesso total + recebe relat√≥rios di√°rios |
| **Vendedor** | `vendedor@test.com` | `password` | Gerenciar vendas + recebe comiss√µes |

---

## üå± Executando Seeders

### Recriar todo o banco de dados com dados de teste:
```bash
docker-compose exec app php artisan migrate:fresh --seed
```

Este comando ir√°:
- Limpar todas as tabelas
- Recriar a estrutura do banco
- Popular com dados de teste:
  - 2 usu√°rios (admin + vendedor)
  - 100 vendedores
  - 100 vendas

### Executar seeders espec√≠ficos:
```bash
# Apenas usu√°rios
docker-compose exec app php artisan db:seed --class=UserSeeder

# Apenas vendedores
docker-compose exec app php artisan db:seed --class=SellerSeeder

# Apenas vendas
docker-compose exec app php artisan db:seed --class=SaleSeeder
```

---

## üìö Documenta√ß√£o Adicional

Este projeto cont√©m arquivos de documenta√ß√£o detalhada:

| Arquivo | Descri√ß√£o |
|---------|-----------|
| **[CONFIGURACAO_CONCLUIDA.md](docs/CONFIGURACAO_CONCLUIDA.md)** | Configura√ß√£o completa de Mailpit e Redis, comandos √∫teis |
| **[SISTEMA_EMAILS.md](docs/SISTEMA_EMAILS.md)** | Sistema de e-mails autom√°ticos para administradores e vendedores |
| **[COMO_TESTAR_EMAILS.md](docs/COMO_TESTAR_EMAILS.md)** | Guia pr√°tico para testar envio de e-mails |

---

## üì° API - Endpoints e Exemplos

A API est√° protegida com **Laravel Sanctum**. Para acessar endpoints protegidos, inclua o token no header:
```
Authorization: Bearer {seu_token}
```

### üîê Autentica√ß√£o

#### **POST** `/api/login`
Autenticar usu√°rio e obter token de acesso.

**Request:**
```json
{
  "email": "admin@test.com",
  "password": "password"
}
```

**Response (200):**
```json
{
  "access_token": "1|abc123def456...",
  "token_type": "Bearer",
  "user": {
    "id": 1,
    "name": "Administrador",
    "email": "admin@test.com",
    "perfil": "Gestor",
    "created_at": "2025-10-06T10:00:00.000000Z",
    "updated_at": "2025-10-06T10:00:00.000000Z"
  }
}
```

**Response (401 - Erro):**
```json
{
  "message": "Credenciais inv√°lidas"
}
```

---

#### **POST** `/api/register`
Registrar novo usu√°rio (sempre como perfil "Seller").

**Request:**
```json
{
  "name": "Jo√£o Silva",
  "email": "joao@example.com",
  "password": "senha123",
  "password_confirmation": "senha123"
}
```

**Response (201):**
```json
{
  "access_token": "2|xyz789...",
  "token_type": "Bearer",
  "user": {
    "id": 2,
    "name": "Jo√£o Silva",
    "email": "joao@example.com",
    "perfil": "Seller",
    "created_at": "2025-10-06T10:05:00.000000Z",
    "updated_at": "2025-10-06T10:05:00.000000Z"
  },
  "message": "Usu√°rio registrado com sucesso"
}
```

---

#### **POST** `/api/logout`
Desconectar usu√°rio (requer autentica√ß√£o).

**Headers:**
```
Authorization: Bearer {seu_token}
```

**Response (200):**
```json
{
  "message": "Logout realizado com sucesso"
}
```

---

### üë• Vendedores (Sellers)

#### **GET** `/api/sellers?page=1&per_page=20&search=maria`
Listar vendedores com pagina√ß√£o e busca.

**Query Parameters:**
- `page` (opcional): N√∫mero da p√°gina (padr√£o: 1)
- `per_page` (opcional): Itens por p√°gina (padr√£o: 20)
- `search` (opcional): Buscar por nome ou email

**Response (200):**
```json
{
  "data": [
    {
      "id": 1,
      "name": "Maria Santos",
      "email": "maria@example.com",
      "sales_count": 15,
      "total_commission": 1234.56,
      "created_at": "2025-09-01T08:00:00.000000Z",
      "updated_at": "2025-10-06T10:00:00.000000Z"
    },
    {
      "id": 2,
      "name": "Maria Silva",
      "email": "maria.silva@example.com",
      "sales_count": 8,
      "total_commission": 678.90,
      "created_at": "2025-09-05T09:30:00.000000Z",
      "updated_at": "2025-10-05T15:20:00.000000Z"
    }
  ],
  "current_page": 1,
  "last_page": 5,
  "per_page": 20,
  "total": 100
}
```

---

#### **POST** `/api/sellers`
Criar novo vendedor.

**Request:**
```json
{
  "name": "Carlos Pereira",
  "email": "carlos@example.com"
}
```

**Response (201):**
```json
{
  "id": 101,
  "name": "Carlos Pereira",
  "email": "carlos@example.com",
  "sales_count": 0,
  "total_commission": 0,
  "created_at": "2025-10-06T11:00:00.000000Z",
  "updated_at": "2025-10-06T11:00:00.000000Z"
}
```

---

#### **GET** `/api/sellers/{id}`
Obter detalhes de um vendedor espec√≠fico.

**Response (200):**
```json
{
  "id": 1,
  "name": "Maria Santos",
  "email": "maria@example.com",
  "sales_count": 15,
  "total_commission": 1234.56,
  "created_at": "2025-09-01T08:00:00.000000Z",
  "updated_at": "2025-10-06T10:00:00.000000Z"
}
```

---

#### **PUT** `/api/sellers/{id}`
Atualizar dados de um vendedor.

**Request:**
```json
{
  "name": "Maria Santos Silva",
  "email": "maria.santos@example.com"
}
```

**Response (200):**
```json
{
  "id": 1,
  "name": "Maria Santos Silva",
  "email": "maria.santos@example.com",
  "sales_count": 15,
  "total_commission": 1234.56,
  "created_at": "2025-09-01T08:00:00.000000Z",
  "updated_at": "2025-10-06T11:30:00.000000Z"
}
```

---

#### **DELETE** `/api/sellers/{id}`
Excluir um vendedor.

**Response (204):** Sem conte√∫do (sucesso)

---

#### **POST** `/api/sellers/{id}/resend-commission-email`
Reenviar e-mail de comiss√£o para um vendedor.

**Request (opcional):**
```json
{
  "date": "2025-10-06"
}
```
> Se `date` n√£o for fornecido, usa a data atual.

**Response (200):**
```json
{
  "message": "E-mail de comiss√£o foi agendado para reenvio",
  "seller": "Maria Santos",
  "date": "2025-10-06"
}
```

---

### üí∞ Vendas (Sales)

#### **GET** `/api/sales?page=1&per_page=20&seller_id=5&date_from=2025-10-01&date_to=2025-10-31`
Listar vendas com filtros.

**Query Parameters:**
- `page` (opcional): N√∫mero da p√°gina
- `per_page` (opcional): Itens por p√°gina
- `seller_id` (opcional): Filtrar por vendedor
- `date_from` (opcional): Data inicial (YYYY-MM-DD)
- `date_to` (opcional): Data final (YYYY-MM-DD)

**Response (200):**
```json
{
  "data": [
    {
      "id": 1,
      "seller_id": 5,
      "amount": 1500.00,
      "commission": 127.50,
      "sale_date": "2025-10-05",
      "created_at": "2025-10-05T14:30:00.000000Z",
      "updated_at": "2025-10-05T14:30:00.000000Z",
      "seller": {
        "id": 5,
        "name": "Jo√£o Silva",
        "email": "joao@example.com"
      }
    },
    {
      "id": 2,
      "seller_id": 5,
      "amount": 750.00,
      "commission": 63.75,
      "sale_date": "2025-10-06",
      "created_at": "2025-10-06T09:15:00.000000Z",
      "updated_at": "2025-10-06T09:15:00.000000Z",
      "seller": {
        "id": 5,
        "name": "Jo√£o Silva",
        "email": "joao@example.com"
      }
    }
  ],
  "current_page": 1,
  "last_page": 5,
  "per_page": 20,
  "total": 100
}
```

---

#### **POST** `/api/sales`
Criar nova venda (comiss√£o calculada automaticamente em 8,5%).

**Request:**
```json
{
  "seller_id": 5,
  "amount": 2000.00,
  "sale_date": "2025-10-06"
}
```

**Response (201):**
```json
{
  "id": 101,
  "seller_id": 5,
  "amount": 2000.00,
  "commission": 170.00,
  "sale_date": "2025-10-06",
  "created_at": "2025-10-06T12:00:00.000000Z",
  "updated_at": "2025-10-06T12:00:00.000000Z",
  "seller": {
    "id": 5,
    "name": "Jo√£o Silva",
    "email": "joao@example.com"
  }
}
```

---

#### **GET** `/api/sales/{id}`
Obter detalhes de uma venda.

**Response (200):**
```json
{
  "id": 1,
  "seller_id": 5,
  "amount": 1500.00,
  "commission": 127.50,
  "sale_date": "2025-10-05",
  "created_at": "2025-10-05T14:30:00.000000Z",
  "updated_at": "2025-10-05T14:30:00.000000Z",
  "seller": {
    "id": 5,
    "name": "Jo√£o Silva",
    "email": "joao@example.com"
  }
}
```

---

#### **PUT** `/api/sales/{id}`
Atualizar uma venda.

**Request:**
```json
{
  "seller_id": 5,
  "amount": 1800.00,
  "sale_date": "2025-10-05"
}
```

**Response (200):**
```json
{
  "id": 1,
  "seller_id": 5,
  "amount": 1800.00,
  "commission": 153.00,
  "sale_date": "2025-10-05",
  "created_at": "2025-10-05T14:30:00.000000Z",
  "updated_at": "2025-10-06T13:00:00.000000Z",
  "seller": {
    "id": 5,
    "name": "Jo√£o Silva",
    "email": "joao@example.com"
  }
}
```

---

#### **DELETE** `/api/sales/{id}`
Excluir uma venda.

**Response (204):** Sem conte√∫do (sucesso)

---

### üìä Dashboard

#### **GET** `/api/dashboard/stats`
Obter estat√≠sticas do dashboard.

**Response (200):**
```json
{
  "total_sellers": 100,
  "total_sales": 250,
  "total_revenue": 125000.50,
  "total_commission": 10625.04,
  "recent_sales": [
    {
      "id": 250,
      "seller_id": 45,
      "amount": 890.00,
      "commission": 75.65,
      "sale_date": "2025-10-06",
      "created_at": "2025-10-06T15:30:00.000000Z",
      "updated_at": "2025-10-06T15:30:00.000000Z",
      "seller": {
        "id": 45,
        "name": "Ana Paula",
        "email": "ana@example.com"
      }
    }
  ],
  "current_month": {
    "sellers": 15,
    "sales": 45,
    "revenue": 22500.00,
    "commission": 1912.50
  },
  "previous_month": {
    "sellers": 12,
    "sales": 38,
    "revenue": 18000.00,
    "commission": 1530.00
  }
}
```

---

## üåê Servi√ßos Dispon√≠veis

| Servi√ßo | URL/Porta | Descri√ß√£o |
|---------|-----------|-----------|
| **Frontend (Vue.js)** | http://localhost:5173 | Interface web do sistema |
| **Backend (Laravel API)** | http://localhost:8080 | API RESTful |
| **Mailpit (Web UI)** | http://localhost:8025 | Visualizar e-mails de desenvolvimento |
| **Mailpit (SMTP)** | localhost:1025 | Porta SMTP para envio |
| **Redis** | localhost:6379 | Cache e filas |
| **MySQL** | localhost:33066 | Banco de dados |

---

## üìß Sistema de E-mails

### üì® E-mail para Vendedores (Di√°rio)
- **Assunto:** Relat√≥rio Di√°rio de Comiss√µes - [DATA]
- **Conte√∫do:** N√∫mero de vendas, valor total e comiss√£o do dia
- **Enviado:** Diariamente √†s 08:00

### üìä E-mail para Administradores (Di√°rio)
- **Assunto:** Relat√≥rio Di√°rio de Vendas - [DATA]
- **Conte√∫do:** Resumo geral de todas as vendas e detalhes por vendedor
- **Enviado:** Diariamente √†s 08:00

### Comando Manual
```bash
# Enviar e-mails do dia anterior
docker-compose exec app php artisan sales:send-daily-emails

# Enviar e-mails de uma data espec√≠fica
docker-compose exec app php artisan sales:send-daily-emails --date=2025-10-05
```

### Ativar Envio Autom√°tico
```bash
# Rodar em background (produ√ß√£o)
docker-compose exec app php artisan schedule:work
```

> Consulte **[SISTEMA_EMAILS.md](docs/SISTEMA_EMAILS.md)** para mais detalhes.

---

## üõ†Ô∏è Comandos √öteis

### Docker
```bash
# Ver status dos containers
docker-compose ps

# Parar todos os containers
docker-compose down

# Reiniciar um container espec√≠fico
docker-compose restart app

# Ver logs
docker-compose logs -f
docker-compose logs -f app

# Acessar terminal do container
docker-compose exec app bash
```

### Laravel
```bash
# Limpar cache
docker-compose exec app php artisan cache:clear
docker-compose exec app php artisan config:clear
docker-compose exec app php artisan route:clear

# Ver rotas
docker-compose exec app php artisan route:list

# Rodar testes
docker-compose exec app php artisan test
```

### Filas (Queue)
```bash
# Iniciar worker
docker-compose exec app php artisan queue:work

# Processar apenas um job
docker-compose exec app php artisan queue:work --once

# Ver jobs com falha
docker-compose exec app php artisan queue:failed

# Reprocessar jobs com falha
docker-compose exec app php artisan queue:retry all
```

### Mailpit
```bash
# Limpar todos os e-mails do Mailpit
curl -X DELETE http://localhost:8025/api/v1/messages

# Ver mensagens via API
curl http://localhost:8025/api/v1/messages
```

---

## üß™ Executando os Testes

```bash
docker-compose exec app php artisan test
```

---

## üìÅ Estrutura do Projeto

```
sales-management/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Console/Commands/       # Comandos Artisan (envio de e-mails)
‚îÇ   ‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controllers/Api/    # Controllers da API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Requests/           # Form Requests (valida√ß√£o)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Resources/          # API Resources (transforma√ß√£o de dados)
‚îÇ   ‚îú‚îÄ‚îÄ Jobs/                   # Jobs de fila (envio de e-mails)
‚îÇ   ‚îú‚îÄ‚îÄ Mail/                   # Mailables (templates de e-mail)
‚îÇ   ‚îú‚îÄ‚îÄ Models/                 # Models Eloquent
‚îÇ   ‚îî‚îÄ‚îÄ Services/               # L√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ factories/              # Factories para testes
‚îÇ   ‚îú‚îÄ‚îÄ migrations/             # Migrations do banco
‚îÇ   ‚îî‚îÄ‚îÄ seeders/                # Seeders (dados de teste)
‚îú‚îÄ‚îÄ frontend/                   # Aplica√ß√£o Vue.js 3
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/         # Componentes Vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/           # Servi√ßos de API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/             # Pinia stores
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ views/              # P√°ginas/Views
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ resources/views/emails/     # Templates Blade de e-mail
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ api.php                 # Rotas da API
‚îÇ   ‚îî‚îÄ‚îÄ console.php             # Comandos agendados
‚îú‚îÄ‚îÄ docker/                     # Configura√ß√µes Docker
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

---

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Sinta-se √† vontade para abrir issues e pull requests.

---

## üìÑ Licen√ßa

Este projeto √© open-source sob a licen√ßa MIT.

---

## üìû Suporte

Para mais informa√ß√µes, consulte os arquivos de documenta√ß√£o:
- [CONFIGURACAO_CONCLUIDA.md](docs/CONFIGURACAO_CONCLUIDA.md)
- [SISTEMA_EMAILS.md](docs/SISTEMA_EMAILS.md)
- [COMO_TESTAR_EMAILS.md](docs/COMO_TESTAR_EMAILS.md)

---

**Desenvolvido com ‚ù§Ô∏è usando Laravel 12 e Vue.js 3**
